<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Timeline</title>
    <link rel="stylesheet" href="/public/css/style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://kit.fontawesome.com/bee494c90d.js"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- sidebar -->
    <div data-include="../partials/sidebar.html"></div>

    <!-- Main -->
    <div class="main">
      <div data-include="../partials/header.html"></div>
      <div class="content"></div>
    <!-- Card Project Timeline -->
    <div class="project-timeline-heading">
      <h4 class="h4-project-timeline">Project Timeline</h4>
      <i class="fa-solid fa-circle-chevron-left" onclick="history.back()"></i>
    </div>
    <div class="card-project-timeline">
      <!-- <img src="../assets/Pic/worker 4.jpg" alt="worker and tower bts" />
      <div class="overlay"></div> -->

      <!-- Timeline -->
       <div class="timeline" id="timeline-container">
        <div class="timeline-line" id="timeline-line"></div>
        <div class="container left-container">
          <i class="fa-solid fa-timeline"></i>
          <div class="text-box">
            <h4>Sprint 1 - Design UI Figma</h4>
            <small>1 Oktober - 16 Oktober</small>
            <p>
              <!-- Batas 320 Karakter -->
              Kinarya Interns is a web-based platform designed to streamline
              internship processes. Key features include attendance tracking,
              daily activity reporting, project management, and comprehensive
              history logs for attendance and reports. This system ensures
              efficient monitoring and documentation of intern activities.
            </p>
            <button class="edit-timeline-btn" onclick="editTimeline(this)">
              Edit
            </button>
          </div>
        </div>
        
        <div class="container right-container">
          <i class="fa-solid fa-timeline"></i>
          <div class="text-box">
            <h4>Sprint 2 - Make a API</h4>
            <small>17 Oktober - 29 Oktober</small>
            <p>
              Kinarya Interns is a web-based platform designed to streamline
              internship processes. Key features include attendance tracking,
              daily activity reporting, project management, and comprehensive
              history logs for attendance and reports. This system ensures
              efficient monitoring and documentation of intern activities.
            </p>
            <button class="edit-timeline-btn" onclick="editTimeline(this)">
              Edit
            </button>
          </div>
        </div>
        
        <div class="container left-container">
          <i class="fa-solid fa-timeline"></i>
          <div class="text-box">
            <h4>Sprint 3 - Connect the Database</h4>
            <small>29 Oktober - 10 November</small>
            <p>
              Kinarya Interns is a web-based platform designed to streamline
              internship processes. Key features include attendance tracking,
              daily activity reporting, project management, and comprehensive
              history logs for attendance and reports. This system ensures
              efficient monitoring and documentation of intern activities and its.
            </p>
            <button class="edit-timeline-btn" onclick="editTimeline(this)">
              Edit
            </button>
          </div>
        </div>
        
        <div class="container right-container">
          <i class="fa-solid fa-timeline"></i>
          <div class="text-box">
            <h4>Sprint 3 - Connect the Database</h4>
            <small>29 Oktober - 10 November</small>
            <p>
              Kinarya Interns is a web-based platform designed to streamline
              internship processes.
            </p>
            <button class="edit-timeline-btn" onclick="editTimeline(this)">
              Edit
            </button>
          </div>
        </div>   
      </div>
      <button onclick="showAddForm()" class="add-timeline-btn">
        Add
      </button>

      <!-- Form Tambah atau Edit Timeline -->
      <div id="timeline-form-container" class="form-container" style="display: none;">
        <div class="form-box">
          <h4 id="form-title">Add New Timeline</h4>
          <label for="title">Title</label>
          <input type="text" id="timeline-title" placeholder="Enter Timeline Title" />

          <label for="date">Date Range</label>
          <input type="text" id="timeline-date" placeholder="Enter Date Range (e.g., 1 Okt- 12 Okt)">

          <label for="desc">Description</label>
          <textarea name="timeline-desc" id="timeline-desc" placeholder="Enter Description"></textarea>

          <div class="button-container">
            <button onclick="saveTimeline()" class="save-btn">Save</button>
            <button onclick="hideForm()" class="cancel-btn">Cancel</button>
          </div>
          </div>
      </div>

      <script src="/public/js/include.js"></script>
  </div>
  <script>
    function toggleDropdown() {
      const dropdownMenu = document.getElementById("dropdown-menu");
      dropdownMenu.style.display = dropdownMenu.style.display === "block" ? "none" : "block";
    }

    // Menutup dropdown jika mengklik di luar dropdown
    window.onclick = function (event) {
      if (!event.target.matches(".fa-bars")) {
        const dropdowns = document.getElementsByClassName("dropdown-menu");
        for (let i = 0; i < dropdowns.length; i++) {
          const openDropdown = dropdowns[i];
          if (openDropdown.style.display === "block") {
            openDropdown.style.display = "none";
          }
        }
      }
    };

    // melacak entri yang sedang diedit
    let editTimelineElement = null;

    // Add Timeline
    function showAddForm () {
      document.getElementById("form-title").innerText = "Add New Timeline";
      document.getElementById("timeline-title").value = "";
      document.getElementById("timeline-date").value = "";
      document.getElementById("timeline-desc").value = "";
      editTimelineElement = null;
      document.getElementById("timeline-form-container").style.display = "flex";
    }
    
    function updateTimelineHeight () {
      const timelineContainer = document.getElementById("timeline-container");
      const timelineLine = document.getElementById("timeline-line");
      const totalItems = timelineContainer.querySelectorAll(".container").length;

      const timelineHeight = totalItems * 340;
      timelineLine.style.height = `${timelineHeight}px`;
    }
    // Edit Timeline
    function editTimeline (button) {
      const textBox = button.parentElement;
      const title = textBox.querySelector("h4").innerText;
      const date = textBox.querySelector("small").innerText;
      const desc = textBox.querySelector("p").innerText;
      
      document.getElementById("form-title").innerText = "Edit Timeline";
      document.getElementById("timeline-title").value = title;
      document.getElementById("timeline-date").value = date;
      document.getElementById("timeline-desc").value = desc;

      editTimelineElement = textBox;
      document.getElementById("timeline-form-container").style.display = "flex";
    }

    function saveTimeline() {
      const title = document.getElementById("timeline-title").value;
      const date = document.getElementById("timeline-date").value;
      const desc = document.getElementById("timeline-desc").value;

      const timelineContainer = document.getElementById("timeline-container");
      const totalItems = timelineContainer.querySelectorAll(".container").length;

      const positionClass = totalItems % 2 === 0 ? "left-container" : "right-container";

      if(editTimelineElement) {
        editTimelineElement.querySelector("h4").innerText = title;
        editTimelineElement.querySelector("small").innerText = date;
        editTimelineElement.querySelector("p").innerText = desc;
      } else {
        const newEntry = document.createElement("div");
        newEntry.classList.add("container", positionClass);
        newEntry.innerHTML = `
        <i class="fa-solid fa-timeline"></i>
        <div class="text-box">
          <h4>${title}</h4>
          <small>${date}</small>
          <p>${desc}</p>
          <button class="edit-timeline-btn" onclick="editTimeline(this)">Edit</button>
        </div>
        `;

        timelineContainer.appendChild(newEntry);
      }

      updateTimelineHeight();

      hideForm();
    }

    function hideForm() {
      document.getElementById("timeline-form-container").style.display = "none";
    }

    document.addEventListener("DOMContentLoaded", () => {
      updateTimelineHeight();
    });

  </script>
</body>
</html>